# Quiz Feature - Complete Architecture & Flow Diagrams

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            LAMLA AI QUIZ SYSTEM                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   React Frontend     â”‚ (Port 3000)
â”‚   - CustomQuiz.jsx   â”‚
â”‚   - Quiz.jsx         â”‚
â”‚   - QuizResults.jsx  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ HTTP (CORS enabled)
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Django ASGI API Gateway (Port 8000)               â”‚
â”‚  - /api/quiz/generate/                                   â”‚
â”‚  - /api/quiz/ajax-extract-text/                          â”‚
â”‚  - /api/quiz/submit/                                     â”‚
â”‚                                                          â”‚
â”‚  Uses: httpx.AsyncClient â†’ persistent connection pool   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ Secret-authenticated HTTP
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        FastAPI Worker (Port 8001)                        â”‚
â”‚  - /quiz/ endpoint                                       â”‚
â”‚  - /chatbot/ endpoint                                    â”‚
â”‚  - Authentication middleware                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ Authenticated HTTP
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        AI Provider Orchestration (ai_client.py)          â”‚
â”‚  - Try Azure (if configured)                            â”‚
â”‚  - Fallback to DeepSeek (if configured)                 â”‚
â”‚  - Fallback to Gemini (if configured)                   â”‚
â”‚  - Fallback to HuggingFace (if configured)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚ API calls with auth
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        External LLM Providers                            â”‚
â”‚  - Azure OpenAI API                                      â”‚
â”‚  - DeepSeek API (optional)                               â”‚
â”‚  - Gemini API (optional)                                â”‚
â”‚  - HuggingFace API (optional)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Database (PostgreSQL):
  - ChatSession (for chat history)
  - ChatMessage (for conversations)
  - (Quiz data currently NOT persisted)
```

---

## Data Flow: Quiz Generation (Text-Based)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: USER INTERACTION (Frontend)                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  CustomQuiz.jsx:                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚ User fills form:            â”‚                                        â”‚
â”‚  â”‚ - Subject: "Physics"        â”‚                                        â”‚
â”‚  â”‚ - Study Text: "Mechanics"   â”‚                                        â”‚
â”‚  â”‚ - MCQ: 5                    â”‚                                        â”‚
â”‚  â”‚ - Short: 2                  â”‚                                        â”‚
â”‚  â”‚ - Difficulty: "medium"      â”‚                                        â”‚
â”‚  â”‚ - Quiz Time: 10 mins        â”‚                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚               â”‚ Validation âœ…                                            â”‚
â”‚               â”‚ - Text 30-50000 chars                                    â”‚
â”‚               â”‚ - At least 1 question type                              â”‚
â”‚               â”‚ - Subject selected                                      â”‚
â”‚               â–¼                                                          â”‚
â”‚  POST /api/quiz/generate/ {                                             â”‚
â”‚    subject: "Physics",                                                  â”‚
â”‚    extractedText: "Mechanics content...",                               â”‚
â”‚    num_mcq: 5,                                                          â”‚
â”‚    num_short: 2,                                                        â”‚
â”‚    difficulty: "medium",                                                â”‚
â”‚    quiz_time: 10                                                        â”‚
â”‚  }                                                                       â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: DJANGO REQUEST HANDLING                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  async_views.py: generate_quiz_api_async()                             â”‚
â”‚                                                                          â”‚
â”‚  1. Parse request JSON âœ…                                               â”‚
â”‚  2. Validate inputs âœ…                                                  â”‚
â”‚  3. Construct FastAPI payload:                                          â”‚
â”‚     {                                                                   â”‚
â”‚       subject: "Physics",                                               â”‚
â”‚       study_text: "Mechanics content...",                               â”‚
â”‚       num_mcq: 5,                                                       â”‚
â”‚       num_short: 2,                                                     â”‚
â”‚       difficulty: "medium"                                              â”‚
â”‚     }                                                                   â”‚
â”‚  4. Get async client & headers âœ…                                       â”‚
â”‚  5. POST http://localhost:8001/quiz/ âœ…                                 â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: FASTAPI QUIZ ENDPOINT                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  routes/quiz.py: quiz_endpoint()                                        â”‚
â”‚                                                                          â”‚
â”‚  1. Validate authentication âœ…                                          â”‚
â”‚  2. Validate payload schema (Pydantic) âœ…                               â”‚
â”‚  3. Build LLM prompt:                                                   â”‚
â”‚     "You are Lamla AI Tutor. Generate a quiz...                         â”‚
â”‚      Subject: Physics                                                   â”‚
â”‚      Study Text: Mechanics content...                                   â”‚
â”‚      Generate 5 MCQs and 2 short answer questions                       â”‚
â”‚      Return ONLY valid JSON..."                                         â”‚
â”‚  4. Call AI service:                                                    â”‚
â”‚     raw = ai_service.generate_content(client, prompt, max_tokens=2048) â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 4: AI CLIENT ORCHESTRATION (FIXED)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  core/ai_client.py: generate_content()                                  â”‚
â”‚                                                                          â”‚
â”‚  1. Try Azure provider âœ…                                               â”‚
â”‚  2. Call Azure OpenAI API âœ…                                            â”‚
â”‚  3. Receive response:                                                   â”‚
â”‚     {                                                                   â”‚
â”‚       "choices": [{                                                     â”‚
â”‚         "message": {                                                    â”‚
â”‚           "content": "{\"mcq_questions\": [Q1, Q2...], ...}"   â—„â”€â”€â”€â”€â”€â”€â” â”‚
â”‚         }                                                               â”‚ â”‚
â”‚       }],                                                               â”‚ â”‚
â”‚       "usage": {...},                                                  â”‚ â”‚
â”‚       ...                                                               â”‚ â”‚
â”‚     }                                                                   â”‚ â”‚
â”‚                                                                         â”‚ â”‚
â”‚  4. ğŸ”§ FIXED: Extract content string from choices[0].message.content â”€â”€â”˜ â”‚
â”‚                                                                          â”‚
â”‚  5. Return: "{\"mcq_questions\": [Q1, Q2...], ...}"  â—„â”€â”€â”€ STRING âœ…    â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 5: FASTAPI QUIZ RESPONSE HANDLING (FIXED)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  routes/quiz.py: quiz_endpoint() - Response Processing                 â”‚
â”‚                                                                          â”‚
â”‚  1. raw = "{\"mcq_questions\": [...], \"short_questions\": [...]}"      â”‚
â”‚                                                                          â”‚
â”‚  2. ğŸ”§ FIXED: Detect response format:                                   â”‚
â”‚     if isinstance(raw, dict) AND "choices" in raw:                      â”‚
â”‚       â†’ Extract content from choices (Azure format)                     â”‚
â”‚     else:                                                               â”‚
â”‚       â†’ Treat as already-parsed JSON                                    â”‚
â”‚                                                                          â”‚
â”‚  3. Parse JSON: data = json.loads(raw) âœ…                              â”‚
â”‚                                                                          â”‚
â”‚  4. Extract questions:                                                  â”‚
â”‚     mcq_questions = data.get("mcq_questions", [])                       â”‚
â”‚     short_questions = data.get("short_questions", [])                   â”‚
â”‚                                                                          â”‚
â”‚  5. Validate: At least one question of some type âœ…                     â”‚
â”‚                                                                          â”‚
â”‚  6. Normalize each question:                                            â”‚
â”‚     {                                                                   â”‚
â”‚       question: "...",                                                  â”‚
â”‚       type: "mcq",                                                      â”‚
â”‚       options: ["A", "B", "C", "D"],                                    â”‚
â”‚       answer: "B",                                                      â”‚
â”‚       explanation: "..."                                                â”‚
â”‚     }                                                                   â”‚
â”‚                                                                          â”‚
â”‚  7. Return response âœ…                                                  â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 6: DJANGO RESPONSE PROCESSING                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  async_views.py: generate_quiz_api_async() - Continue                  â”‚
â”‚                                                                          â”‚
â”‚  1. Receive quiz_data from FastAPI âœ…                                   â”‚
â”‚  2. Add metadata for frontend:                                          â”‚
â”‚     quiz_data['id'] = str(uuid.uuid4())                                 â”‚
â”‚     quiz_data['time_limit'] = 10  # minutes                             â”‚
â”‚     quiz_data['created_at'] = None                                      â”‚
â”‚  3. Return JsonResponse(quiz_data) âœ…                                   â”‚
â”‚                                                                          â”‚
â”‚  Response to Frontend:                                                  â”‚
â”‚  {                                                                       â”‚
â”‚    "subject": "Physics",                                                â”‚
â”‚    "study_text": "...",                                                â”‚
â”‚    "difficulty": "medium",                                              â”‚
â”‚    "mcq_questions": [                                                   â”‚
â”‚      {                                                                  â”‚
â”‚        "question": "What is velocity?",                                â”‚
â”‚        "type": "mcq",                                                  â”‚
â”‚        "options": ["Speed", "Acceleration", "Distance", "Force"],      â”‚
â”‚        "answer": "A",                                                  â”‚
â”‚        "explanation": "Velocity is the speed of an object in a..."    â”‚
â”‚      },                                                                â”‚
â”‚      ...                                                               â”‚
â”‚    ],                                                                  â”‚
â”‚    "short_questions": [...],                                           â”‚
â”‚    "id": "550e8400-e29b-41d4-a716-446655440000",                      â”‚
â”‚    "time_limit": 10,                                                   â”‚
â”‚    "created_at": null                                                  â”‚
â”‚  }                                                                      â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 7: FRONTEND DISPLAY                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  CustomQuiz.jsx:                                                        â”‚
â”‚  â†’ Receives quiz_data âœ…                                                â”‚
â”‚  â†’ navigate('/quiz', { state: { quizData: response.data } })            â”‚
â”‚                                                                          â”‚
â”‚  Quiz.jsx:                                                              â”‚
â”‚  â†’ Receives quizData from location.state âœ…                             â”‚
â”‚  â†’ Merges MCQ and short questions: allQuestions = [...]                 â”‚
â”‚  â†’ Sets timer: timeRemaining = time_limit * 60 seconds                  â”‚
â”‚  â†’ Displays first question âœ…                                           â”‚
â”‚  â†’ Stores progress in LocalStorage                                      â”‚
â”‚                                                                          â”‚
â”‚  âœ… QUIZ PAGE LOADS SUCCESSFULLY âœ…                                     â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow: Quiz Submission

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ USER SUBMITS QUIZ                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  Quiz.jsx: submitQuiz()                                                 â”‚
â”‚  POST /api/quiz/submit/ {                                               â”‚
â”‚    quiz_id: "550e8400-e29b-41d4-a716-446655440000",                    â”‚
â”‚    quiz_data: {                                                         â”‚
â”‚      mcq_questions: [...],                                              â”‚
â”‚      short_questions: [...]                                             â”‚
â”‚    },                                                                   â”‚
â”‚    user_answers: {                                                      â”‚
â”‚      "0": "A",        // MCQ - letter answer                            â”‚
â”‚      "1": "B",                                                          â”‚
â”‚      "2": "Newton's Second Law",  // Short answer                       â”‚
â”‚      ...                                                                â”‚
â”‚    },                                                                   â”‚
â”‚    total_questions: 7                                                   â”‚
â”‚  }                                                                       â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DJANGO: CALCULATE SCORES                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  async_views.py: submit_quiz_api_async()                                â”‚
â”‚                                                                          â”‚
â”‚  1. Extract questions from quiz_data âœ…                                 â”‚
â”‚  2. Initialize: correct_count = 0, details = []                         â”‚
â”‚  3. FOR EACH question (index, question):                                â”‚
â”‚     a) Get user_answer from user_answers[index]                         â”‚
â”‚     b) Get correct_answer from question["answer"]                       â”‚
â”‚     c) Compare based on type:                                           â”‚
â”‚        - MCQ: Extract first letter, compare case-insensitive            â”‚
â”‚          user_letter = user_answer.upper()[0]                           â”‚
â”‚          correct_letter = correct_answer.upper()[0]                     â”‚
â”‚          is_correct = user_letter == correct_letter                     â”‚
â”‚        - Short: Case-insensitive string comparison                       â”‚
â”‚          is_correct = user_answer.lower() == correct_answer.lower()     â”‚
â”‚     d) If correct, increment correct_count                              â”‚
â”‚     e) Append to details with full info                                 â”‚
â”‚  4. Calculate: score_percent = (correct_count / total) * 100            â”‚
â”‚  5. Return results âœ…                                                    â”‚
â”‚                                                                          â”‚
â”‚  Response:                                                              â”‚
â”‚  {                                                                       â”‚
â”‚    "quiz_id": "550e8400-e29b-41d4-a716-446655440000",                  â”‚
â”‚    "subject": "Physics",                                                â”‚
â”‚    "difficulty": "medium",                                              â”‚
â”‚    "score": 5,                                                          â”‚
â”‚    "total": 7,                                                          â”‚
â”‚    "score_percent": 71.4,                                               â”‚
â”‚    "details": [                                                         â”‚
â”‚      {                                                                  â”‚
â”‚        "question_index": 0,                                             â”‚
â”‚        "question": "What is velocity?",                                â”‚
â”‚        "user_answer": "A",                                              â”‚
â”‚        "correct_answer": "A",                                           â”‚
â”‚        "is_correct": true,                                              â”‚
â”‚        "explanation": "Velocity is speed in a direction"               â”‚
â”‚      },                                                                 â”‚
â”‚      ...                                                                â”‚
â”‚    ],                                                                   â”‚
â”‚    "submitted_at": null                                                 â”‚
â”‚  }                                                                       â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FRONTEND: DISPLAY RESULTS                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                          â”‚
â”‚  Quiz.jsx â†’ navigate('/quiz/results', { state: { results } })          â”‚
â”‚                                                                          â”‚
â”‚  QuizResults.jsx:                                                       â”‚
â”‚  1. Display score: 5/7                                                  â”‚
â”‚  2. Display percentage: 71.4%                                           â”‚
â”‚  3. Show message based on score:                                        â”‚
â”‚     - â‰¥ 80%: "Excellent Work!"                                          â”‚
â”‚     - â‰¥ 50%: "Good Effort!"                                             â”‚
â”‚     - < 50%: "Time to Review!"                                          â”‚
â”‚  4. List each question with:                                            â”‚
â”‚     - Question text                                                     â”‚
â”‚     - User's answer                                                     â”‚
â”‚     - Correct answer                                                    â”‚
â”‚     - Explanation                                                       â”‚
â”‚     - Status (âœ… Correct / âŒ Incorrect / âŠ™ Unanswered)               â”‚
â”‚  5. Buttons:                                                            â”‚
â”‚     - Share                                                             â”‚
â”‚     - Generate New Quiz                                                 â”‚
â”‚                                                                          â”‚
â”‚  âœ… RESULTS DISPLAYED SUCCESSFULLY âœ…                                   â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Key Fixes Applied

### Fix 1: Azure Response Extraction
```
BEFORE (BROKEN):
  Azure Response
  {"choices": [{"message": {"content": "quiz JSON"}}], ...}
  â†“
  ai_client returns: {"choices": [...], ...}  â† FULL DICT
  â†“
  quiz.py looks for mcq_questions at top level â†’ NOT FOUND âŒ

AFTER (FIXED):
  Azure Response
  {"choices": [{"message": {"content": "quiz JSON"}}], ...}
  â†“
  ai_client extracts and returns: "quiz JSON"  â† JUST CONTENT âœ…
  â†“
  quiz.py detects Azure format â†’ extracts content
  â†“
  quiz.py finds mcq_questions at top level â†’ SUCCESS âœ…
```

### Fix 2: Quiz Response Handling
```
BEFORE (BROKEN):
  if isinstance(raw, dict):
      data = raw  â† Assumes it's quiz JSON
  
  mcq_questions = data.get("mcq_questions")  â† NOT FOUND

AFTER (FIXED):
  if isinstance(raw, dict):
      if "choices" in raw:  â† Detect Azure format
          extract content from choices
          data = json.loads(content)
      else:
          data = raw  â† Assume it's quiz JSON
  
  mcq_questions = data.get("mcq_questions")  â† FOUND âœ…
```

---

## Summary

âœ… **Quiz Generation:** Text/File â†’ Prompt â†’ Azure â†’ Response extraction â†’ Normalized questions â†’ Frontend âœ…

âœ… **Quiz Taking:** Displays questions â†’ Captures answers â†’ Stores progress â†’ Allows submission âœ…

âœ… **Results:** Scores calculated â†’ Details displayed â†’ Explanations shown âœ…

**Result:** Complete, working quiz feature from generation to results!

